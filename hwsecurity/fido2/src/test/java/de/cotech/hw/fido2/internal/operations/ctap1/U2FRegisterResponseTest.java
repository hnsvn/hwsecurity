package de.cotech.hw.fido2.internal.operations.ctap1;


import de.cotech.hw.util.Hex;
import org.bouncycastle.util.encoders.Base64;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.robolectric.RobolectricTestRunner;

import static org.junit.Assert.assertArrayEquals;
import static org.junit.Assert.assertEquals;

@RunWith(RobolectricTestRunner.class)
public class U2FRegisterResponseTest {
    private byte[] U2F_RESPONSE_DATA = Hex.decodeHexOrFail("050418d25e92eea125f492a6b3aa1cb6ca908a4140cc9ce410c61e05677f7ebc3fc85d1b64d2c6aeb0aebd7fa6d3abf68d54f6bc174ed668809d3f93d49f958ba3ff3037fa0f52c4028cbd61def850e0ef6c2c1bee8929423f6a7e7b0e7919e4767b46a424f5d076d67f5805c43d56db1ec859308202e93082028ea003020102020101300a06082a8648ce3d040302308182310b30090603550406130255533111300f06035504080c084d6172796c616e6431143012060355040a0c0b534f4c4f204841434b45523110300e060355040b0c07526f6f742043413115301306035504030c0c736f6c6f6b6579732e636f6d3121301f06092a864886f70d010901161268656c6c6f40736f6c6f6b6579732e636f6d3020170d3138313231313032323031325a180f32303638313132383032323031325a308194310b30090603550406130255533111300f06035504080c084d6172796c616e6431143012060355040a0c0b534f4c4f204841434b455231223020060355040b0c1941757468656e74696361746f72204174746573746174696f6e3115301306035504030c0c736f6c6f6b6579732e636f6d3121301f06092a864886f70d010901161268656c6c6f40736f6c6f6b6579732e636f6d3059301306072a8648ce3d020106082a8648ce3d030107034200047d78f6beca40763bc75ce3acf42712c394981337a6410e92f69a3b15478db6ced9d34f3913ed127b81143be8f94c9638fee3d6cb1b5393a274f7139a0f9d5ea6a381de3081db301d0603551d0e041604149afba2210923b5e47a2a1d7a6c4e038992a30ec23081a10603551d23048199308196a18188a48185308182310b30090603550406130255533111300f06035504080c084d6172796c616e6431143012060355040a0c0b534f4c4f204841434b45523110300e060355040b0c07526f6f742043413115301306035504030c0c736f6c6f6b6579732e636f6d3121301f06092a864886f70d010901161268656c6c6f40736f6c6f6b6579732e636f6d820900ebd4845014abd15730090603551d1304023000300b0603551d0f0404030204f0300a06082a8648ce3d0403020349003046022100a17b2a1d4e42a8686d65611ef5fe6dc699ae7c208316bad6e50fd70d7e05dac90221009249f30b57d11972f2755aa2e0b6bd0f0738d0e5a24fa0f3876182d8cd48fc57304402206b8729e64c4756a458bcacb428333e4a2ea134a3e612007ff4c82978d53c5fc602200f3cb353e10bcd9c649f7c02612157bd819799313589d8d9cc0bbbae235f426d");
    // byte[] U2F_RESPONSE_DATA = Hex.decodeHexOrFail("05048227f392a231df366f909ab1f5991da19cd292a8c6d910b19cd007db19a4c7f342f29d24bcc4f49584de173ac4a4668f4651fbe6ae057684e362869b6e8fced040f39fa17ce0ea8b278047b396c37b9a55452d3782f814bf2b6a9cace7e966e1b5a27a554ff03928323bd54d648941cb22e23a0e414446c5d1b0b5fd357f546f7e3082024f30820137a00302010202044c8526dc300d06092a864886f70d01010b0500302e312c302a0603550403132359756269636f2055324620526f6f742043412053657269616c203435373230303633313020170d3134303830313030303030305a180f32303530303930343030303030305a3031312f302d06035504030c2659756269636f205532462045452053657269616c2032333932353733353038313435333237363059301306072a8648ce3d020106082a8648ce3d03010703420004507f8c04c280c954a67ad07bb9f60e6a66c0d919e1599ab83090bb4f6e823f456e861013648e4484e05fc65bfee86efe63ee6af9de1be02e91d16b5fda0de3fda33b3039302206092b0601040182c40a020415312e332e362e312e342e312e34313438322e312e323013060b2b0601040182e51c020101040403020430300d06092a864886f70d01010b050003820101003fb81882c0147e4428413837a2859da65648c5df814d3dc54db3b5a944b4135df2e78b661bd5aefd73e437c97cf2238cf44dc8a46682c055aa63d422e2d197877c94ea8afd9fc430e4bc64cb88c9b56566ea1f11be130593abcc0e399a3ed797194571fad9dc26dbeed0808b9217ce380fbea35e40c0f738aac698f15407343cbce1696c08105785e25f5230594efd8b9b35b4e3e43258d14655c54526e0436ce8d42af7a234ff5c018462f3b27d3d06d22e7df9596afa14475fa72283008f0fc8cf061ab31e6ad43497cfe903b60cfc290ed95e306f927102c69b771ac5534f56074758d0e5ceb407b35dec80b4d0acf2e4977797c142d7044cc1b8087fba7b3046022100f406898fb7a176bc3aa6a999e39fdbb805bf0085abb1a0e39e817ca9118c6e960221008baa8ed86430c19c8a8ffa843887e668e3ca902e5bbc05b284e29042618e47e8");
    private static final String PUBLIC_KEY_HEX =
            "0418d25e92eea125f492a6b3aa1cb6ca908a4140cc9ce410c61e05677f7ebc3fc85d1b64d2c6aeb0aebd7fa6d3abf68d54f6bc174ed668809d3f93d49f958ba3ff";

    private static final byte[] CERT_DATA = Base64.decode(
            "MIIC6TCCAo6gAwIBAgIBATAKBggqhkjOPQQDAjCBgjELMAkGA1UEBhMCVVMx\n"+
            "ETAPBgNVBAgMCE1hcnlsYW5kMRQwEgYDVQQKDAtTT0xPIEhBQ0tFUjEQMA4G\n"+
            "A1UECwwHUm9vdCBDQTEVMBMGA1UEAwwMc29sb2tleXMuY29tMSEwHwYJKoZI\n"+
            "hvcNAQkBFhJoZWxsb0Bzb2xva2V5cy5jb20wIBcNMTgxMjExMDIyMDEyWhgP\n"+
            "MjA2ODExMjgwMjIwMTJaMIGUMQswCQYDVQQGEwJVUzERMA8GA1UECAwITWFy\n"+
            "eWxhbmQxFDASBgNVBAoMC1NPTE8gSEFDS0VSMSIwIAYDVQQLDBlBdXRoZW50\n"+
            "aWNhdG9yIEF0dGVzdGF0aW9uMRUwEwYDVQQDDAxzb2xva2V5cy5jb20xITAf\n"+
            "BgkqhkiG9w0BCQEWEmhlbGxvQHNvbG9rZXlzLmNvbTBZMBMGByqGSM49AgEG\n"+
            "CCqGSM49AwEHA0IABH149r7KQHY7x1zjrPQnEsOUmBM3pkEOkvaaOxVHjbbO\n"+
            "2dNPORPtEnuBFDvo+UyWOP7j1ssbU5OidPcTmg+dXqajgd4wgdswHQYDVR0O\n"+
            "BBYEFJr7oiEJI7XkeiodemxOA4mSow7CMIGhBgNVHSMEgZkwgZahgYikgYUw\n"+
            "gYIxCzAJBgNVBAYTAlVTMREwDwYDVQQIDAhNYXJ5bGFuZDEUMBIGA1UECgwL\n"+
            "U09MTyBIQUNLRVIxEDAOBgNVBAsMB1Jvb3QgQ0ExFTATBgNVBAMMDHNvbG9r\n"+
            "ZXlzLmNvbTEhMB8GCSqGSIb3DQEJARYSaGVsbG9Ac29sb2tleXMuY29tggkA\n"+
            "69SEUBSr0VcwCQYDVR0TBAIwADALBgNVHQ8EBAMCBPAwCgYIKoZIzj0EAwID\n"+
            "SQAwRgIhAKF7Kh1OQqhobWVhHvX+bcaZrnwggxa61uUP1w1+BdrJAiEAkknz\n"+
            "C1fRGXLydVqi4La9Dwc40OWiT6Dzh2GC2M1I/Fc=");

    @Test
    public void fromBytes() throws Exception {
        U2fRegisterResponse u2fResponse = U2fRegisterResponse.fromBytes(U2F_RESPONSE_DATA);
        assertEquals(PUBLIC_KEY_HEX, Hex.encodeHexString(u2fResponse.publicKey()));
        assertArrayEquals(CERT_DATA, u2fResponse.attestationCertificate());
    }
}